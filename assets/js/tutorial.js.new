/**
 * Script de tutoriel interactif pour TrucsPasChers
 * Version simplifi√©e et corrig√©e
 */
document.addEventListener('DOMContentLoaded', function () {
    console.log('Script de tutoriel charg√©');
    const startTutorialButton = document.getElementById('start-tutorial-btn');
    
    // Si le bouton n'existe pas, on arr√™te ici
    if (!startTutorialButton) {
        console.warn('Bouton de tutoriel non trouv√© dans le DOM');
        return;
    }
    
    console.log('Bouton de tutoriel trouv√©, ID:', startTutorialButton.id);
    
    // √âtapes de base du tutoriel (sans d√©pendance √† l'API)
    const tutorialSteps = [
        {
            title: 'üëã Bienvenue sur TrucsPasChers!',
            intro: "Bienvenue dans ce tutoriel interactif! Nous allons vous guider √† travers les fonctionnalit√©s principales de notre plateforme.",
            position: 'center'
        },
        {
            element: '#tutorial-step-1',
            title: 'üè† Logo et Accueil',
            intro: "Voici notre logo <strong>TrucsPasChers</strong>! Cliquez dessus pour revenir √† l'accueil √† tout moment.",
            position: 'bottom'
        },
        {
            element: '#tutorial-step-2',
            title: 'üß≠ Menu de navigation',
            intro: "Utilisez ce menu pour naviguer facilement entre les diff√©rentes sections de notre site.",
            position: 'bottom'
        },
        {
            element: '#tutorial-step-3',
            title: 'üîç Recherche',
            intro: "Utilisez cette barre pour <strong>rechercher des produits</strong>.",
            position: 'bottom'
        },
        {
            element: '#tutorial-step-4',
            title: 'üõí Votre panier',
            intro: "C'est votre <strong>panier d'achat</strong>. Le nombre affich√© indique combien d'articles s'y trouvent.",
            position: 'left'
        },
        {
            title: 'üéâ Vous √™tes pr√™t!',
            intro: "F√©licitations! Vous connaissez maintenant les bases pour utiliser notre site.",
            position: 'center'
        }
    ];
    
    // Fonction principale pour lancer le tutoriel
    function startTutorial() {
        console.log('Lancement du tutoriel');
        
        try {
            // V√©rifier si Intro.js est disponible
            if (typeof introJs !== 'function') {
                console.error('La biblioth√®que Intro.js n\'est pas charg√©e');
                alert('Erreur: La biblioth√®que Intro.js n\'est pas charg√©e');
                return;
            }
            
            // Cr√©er et configurer le tutoriel avec les √©tapes par d√©faut
            const intro = introJs();
            
            intro.setOptions({
                steps: tutorialSteps,
                nextLabel: 'Suivant ‚Üí',
                prevLabel: '‚Üê Pr√©c√©dent',
                doneLabel: 'Termin√©',
                skipLabel: 'Passer',
                showBullets: true,
                showProgress: true,
                tooltipClass: 'customTooltip'
            });
            
            // √âv√©nement √† la fin du tutoriel
            intro.oncomplete(function() {
                console.log('Tutoriel termin√©');
                localStorage.setItem('tutorialSeen', 'true');
                localStorage.setItem('tutorialCompleted', 'true');
                showTutorialCompleteFeedback();
            });
            
            // √âv√©nement si l'utilisateur quitte le tutoriel
            intro.onexit(function() {
                console.log('Tutoriel quitt√©');
                localStorage.setItem('tutorialSeen', 'true');
            });
            
            // Lancer le tutoriel
            intro.start();
            console.log('Tutoriel d√©marr√© avec succ√®s');
            
        } catch (error) {
            console.error('Erreur lors du lancement du tutoriel:', error);
            alert('Une erreur s\'est produite lors du lancement du tutoriel');
        }
    }
    
    // Attacher l'√©v√©nement de clic au bouton de tutoriel
    startTutorialButton.addEventListener('click', startTutorial);
    console.log('√âv√©nement de clic ajout√© au bouton de tutoriel');
    
    // Fonction pour afficher un message de f√©licitation apr√®s avoir termin√© le tutoriel
    function showTutorialCompleteFeedback() {
        // Cr√©er un √©l√©ment de notification
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center';
        notification.style.transition = 'all 0.5s ease';
        notification.style.opacity = '0';
        
        // Contenu de la notification
        notification.innerHTML = `
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span>Bravo! Vous avez termin√© le tutoriel avec succ√®s!</span>
        `;
        
        // Ajouter √† la page
        document.body.appendChild(notification);
        
        // Animer l'apparition
        setTimeout(() => {
            notification.style.opacity = '1';
        }, 100);
        
        // Supprimer apr√®s 5 secondes
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                notification.remove();
            }, 500);
        }, 5000);
    }
});
